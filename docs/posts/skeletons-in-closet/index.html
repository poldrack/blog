<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-99.9.9">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Russ Poldrack">
<meta name="dcterms.date" content="2012-03-06">

<title>Russ Poldrack’s blog - Skeletons in the closet</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-R0530E6SNQ"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-R0530E6SNQ', { 'anonymize_ip': true});
</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Russ Poldrack’s blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://profiles.stanford.edu/russell-poldrack" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/poldrack" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://mastodon.online/@Russpoldrack" rel="" target=""><i class="bi bi-mastodon" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Skeletons in the closet</h1>
                      </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Russ Poldrack </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">March 6, 2012</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p><em>This was originally posted on blogger <a href="https://russpoldrack.blogspot.com/2012/03/skeletons-in-closet.html">here</a></em>.</p>
<p>As someone who has <a href="http://www.nytimes.com/2007/11/14/opinion/lweb14brain.html?_r=1">thrown</a> <a href="http://www.russpoldrack.org/2011/10/nyt-editorial-fmri-complete-crap.html">lots</a> <a href="http://www.blogger.com/">of</a> <a href="http://www.ncbi.nlm.nih.gov/pubmed/21856431">stones</a> in recent years, it’s easy to forget that anyone who publishes enough will end up with some skeletons in their closet. I was reminded of that fact today, when<a href="http://oscci.psy.ox.ac.uk/people/dorothy-bishop/">Dorothy Bishop</a> posted a <a href="http://deevybee.blogspot.com/2012/03/time-for-neuroimaging-to-clean-up-its.html">detailed analysis</a> of <a href="http://www.pnas.org/content/100/5/2860.abstract">a paper that was published in 2003 on which I am a coauthor</a>.This paper studied a set of children diagnosed with dyslexia who were scanned before and after treatment with the Fast ForWord training program. The results showed improved language and reading function, which were associated with changes in brain activation. Dorothy notes four major problems with the study:There was no dyslexic control group; thus, we don’t know whether any improvements over time were specific to the treatment, or would have occurred with a control treatment or even without any treatment.The brain imaging data were thresholded using an uncorrected threshold.One of the main conclusions (the “normalization” of activation following training”) is not supported by the necessary interaction statistic, but rather by a visual comparison of maps. The correlation between changes in language scores and activation was reported for only one of the many measures, and it appeared to have been driven by outliers.Looking back at the paper, I see that Dorothy is absolutely right on each of these points. In defense of my coauthors, I would note that points 2-4 were basically standard practice in fMRI analysis 10 years ago (and still crop up fairly often today). Ironically, I raised two of of these issues in my <a href="http://www.ncbi.nlm.nih.gov/pubmed/21856431">recent paper</a> for the special issue of Neuroimage celebrating the 20th anniversary of fMRI, in talking about the need for increased methodological rigor:Foremost, I hope that in the next 20 years the field of cognitive neuroscience will increase the rigor with which it applies neuroimaging methods. The recent debates about circularity and “voodoo correlations” (<a href="http://www.sciencedirect.com.ezproxy.lib.utexas.edu/science/article/pii/S1053811911008949#bb0080">[Kriegeskorte et al., 2009]</a> and <a href="http://www.sciencedirect.com.ezproxy.lib.utexas.edu/science/article/pii/S1053811911008949#bb0170">[Vul et al., 2009]</a>) have highlighted the need for increased care regarding analytic methods. Consideration of similar debates in genetics and clinical trials led (<a href="http://www.sciencedirect.com.ezproxy.lib.utexas.edu/science/article/pii/S1053811911008949#bb0060">Ioannidis, 2005</a>) to outline a number of factors that may contribute to increased levels of spurious results in any scientific field, and the degree to which many of these apply to fMRI research is rather sobering:•small sample sizes•small effect sizes•large number of tested effects•flexibilty in designs, definitions, outcomes, and analysis methods•being a “hot” scientific fieldSome simple methodological improvements could make a big difference. First, the field needs to agree that inference based on uncorrected statistical results is not acceptable (cf.&nbsp;<a href="http://www.sciencedirect.com.ezproxy.lib.utexas.edu/science/article/pii/S1053811911008949#bb0020">Bennett et al., 2009</a>). Many researchers have digested this important fact, but it is still common to see results presented at thresholds such as uncorrected p &lt; .005. Because such uncorrected thresholds do not adapt to the data (e.g., the number of voxels tests or their spatial smoothness), they are certain to be invalid in almost every situation (potentially being either overly liberal or overly conservative). As an example, I took the fMRI data from <a href="http://www.sciencedirect.com.ezproxy.lib.utexas.edu/science/article/pii/S1053811911008949#bb0155">Tom et al.&nbsp;(2007)</a>, and created a random “individual difference” variable. Thus, there should be no correlations observed other than Type I errors. However, thresholding at uncorrected p &lt; .001 and a minimum cluster size of 25 voxels (a common heuristic threshold) showed a significant region near the amygdala; <a href="http://www.sciencedirect.com.ezproxy.lib.utexas.edu/science/article/pii/S1053811911008949#f0005">Fig. 1</a> shows this region along with a plot of the “beautiful” (but artifactual) correlation between activation and the random behavioral variable. This activation was not present when using a corrected statistic. A similar point was made in a more humorous way by <a href="http://www.sciencedirect.com.ezproxy.lib.utexas.edu/science/article/pii/S1053811911008949#bb0025">Bennett et al.&nbsp;(2010)</a>, who scanned a dead salmon being presented with a social cognition task and found activation when using an uncorrected threshold. There are now a number of well-established methods for multiple comparisons correction (<a href="http://www.sciencedirect.com.ezproxy.lib.utexas.edu/science/article/pii/S1053811911008949#bb0125">Poldrack et al., 2011</a>), such that there is absolutely no excuse to present results at uncorrected thresholds. The most common reason for failing to use rigorous corrections for multiple tests is that with smaller samples these methods are highly conservative, and thus result in a high rate of false negatives. This is certainly a problem, but I don’t think that the answer is to present uncorrected results; rather, the answer is to ensure that one’s sample is large enough to provide sufficient statistical power to find the effects of interest.Second, I have become increasingly concerned about the use of “small volume corrections” to address the multiple testing problem. The use of a priori masks to constrain statistical testing is perfectly legitimate, but one often gets the feeling that the masks used for small volume correction were chosen after seeing the initial results (perhaps after a whole-brain corrected analysis was not significant). In such a case, any inferences based on these corrections are circular and the statistics are useless. Researchers who plan to use small volume corrections in their analysis should formulate a specific analysis plan prior to any analyses, and only use small volume corrections that were explicitly planned a priori. This sounds like a remedial lesson in basic statistics, but unfortunately it seems to be regularly forgotten by researchers in the field. Third, the field needs to move toward the use of more robust methods for statistical inference (e.g., <a href="http://www.sciencedirect.com.ezproxy.lib.utexas.edu/science/article/pii/S1053811911008949#bb0055">Huber, 2004</a>). In particular, analyses of correlations between activation and behavior across subjects are highly susceptible to the influence of outlier subjects, especially with small sample sizes. Robust statistical methods can ensure that the results are not overly influenced by these outliers, either by reducing the effect of outlier datapoints (e.g., robust regression using iteratively reweighted least squares) or by separately modeling data points that fall too far outside of the rest of the sample (e.g., mixture modeling). Robust tools for fMRI group analysis are increasingly available, both as part of standard software packages (such as the “outlier detection” technique implemented in FSL: <a href="http://www.sciencedirect.com.ezproxy.lib.utexas.edu/science/article/pii/S1053811911008949#bb0180">Woolrich, 2008</a>) and as add-on toolboxes (<a href="http://www.sciencedirect.com.ezproxy.lib.utexas.edu/science/article/pii/S1053811911008949#bb0175">Wager et al., 2005</a>). Given the frequency with which outliers are observed in group fMRI data, these methods should become standard in the field. However, it’s also important to remember that they are not a panacea, and that it remains important to apply sufficient quality control to statistical results, in order to understand the degree to which one’s results reflect generalizeable patterns versus statistical figments.It should be clear from these comments that my faith in the results of any study that uses such problematic methods (as the Temple et al.&nbsp;study did) is relatively weak. I personally have learned my lesson and our lab now does its best to adhere to these more rigorous standards, even when they mean that a study sometimes ends up being unpublishable. I can only hope that others will join me.</p>
<hr>
<section id="comments-captured-from-original-post-on-blogger" class="level2">
<h2 class="anchored" data-anchor-id="comments-captured-from-original-post-on-blogger">11 comments captured from <a href="https://russpoldrack.blogspot.com/2012/03/skeletons-in-closet.html">original post</a> on Blogger</h2>
<p><strong>drbrocktagon said on 2012-03-06</strong></p>
<p>If only all scientists were as willing to admit previous mistakes.<br><br>I think, however, your second-to-last sentence reveals the real problem. If you perform a study badly and get "interesting" results, somebody somewhere will publish it (PNAS if you know the right people). Doing the study properly can make it unpublishable.</p>
<p><strong>Anders Eklund said on 2012-04-11</strong></p>
<p>Even if activity maps are corrected for multiple testing the results can be invalid<br><br>http://www.sciencedirect.com/science/article/pii/S1053811912003825?v=s5</p>
<p><strong>Unknown said on 2013-05-17</strong></p>
<p>As a reviewer, what is your practice in detecting wrong usage of small volume correction?<br></p>
<p><strong>Russ Poldrack said on 2013-05-18</strong></p>
<p>It’s really tough to give a general rule. I feel better about it if it follows directly from previous work by the same group, such that the same area is corrected across multiple papers and there is a stronger reason to think that they set out with that specific hypothesis in mind.</p>
<p><strong>Unknown said on 2013-05-18</strong></p>
<p>I agree. Cases, like FFA to face processing, amygdala to emotion and hippocampals to memory, are widely accepted. <br><br>But there are some other omnipotent regions in fMRI studies, such as the insula cortex. <br>In addition, as we know, a researcher can always find several published papers that support what he finds in his result, when trying to do some interpretation. That is, they can always collect some papers to support their choices of regions for small volume correction.<br><br>So, I wonder whether our neuroscientists can provide a list of cognition-region pairs (e.g., face recognition-FFA) that are proper to use with small volume correction. <br><br></p>
<p><strong>Russ Poldrack said on 2013-05-18</strong></p>
<p>I think a better solution would be to give people a chance to pre-register their hypotheses and ROIs prior to data collection and analysis. That would allow more flexibility for new hypotheses but would still help prevent post-hoc SVCs.</p>
<p><strong>Unknown said on 2013-05-18</strong></p>
<p>That’s to say, researchers should publish their papers mostly based on the self-discipline. :)</p>
<p><strong>Student said on 2016-07-21</strong></p>
<p>In another opinion paper regarding fMRI analyses and reporting (http://www.ncbi.nlm.nih.gov/pubmed/21856431), Dr.&nbsp;Poldrack states “Some simple methodological improvements could make a big difference. First, the field needs to agree that inference based on uncorrected statistical results is not acceptable (cf.&nbsp;Bennett et al., 2009). Many researchers have digested this important fact, but it is still common to see results presented at thresholds such as uncorrected p&lt;.005. Because such uncorrected thresholds do not adapt to the data (e.g., the number of voxels tests or their spatial smoothness), they are certain to be invalid in almost every situation (potentially being either overly liberal or overly conservative).” This is a good point, but given the fact that Dr.&nbsp;Poldrack has published papers in high impact journals that rely heavily on inferences from data using uncorrected thresholds (e.g.&nbsp;http://www.ncbi.nlm.nih.gov/pubmed/16157284), and does not appear to have issued any statements to the journals regarding their validity, one wonders whether Dr.&nbsp;Poldrack wants to have his cake and eat it too, so to say. A similar point can be made regarding Dr.&nbsp;Poldrack’s attitude regarding the use of small volume correction. In this paper, he states “Second, I have become increasingly concerned about the use of “small volume corrections” to address the multiple testing problem. The use of a priori masks to constrain statistical testing is perfectly legitimate, but one often gets the feeling that the masks used for small volume correction were chosen after seeing the initial results (perhaps after a whole-brain corrected analysis was not significant). In such a case, any inferences based on these corrections are circular and the statistics are useless”. While this is also true, one wonders whether Dr.&nbsp;Poldrack only trusts his group to use this tool correctly, since it is frequently employed in his papers. <br>In a third opinion paper (http://www.ncbi.nlm.nih.gov/pubmed/20571517), Dr.&nbsp;Poldrack discusses the problem of circularity in fMRI analyses. While this is also an important topic, Dr.&nbsp;Poldrack’s group has also published papers using circular analyses (e.g.&nbsp;http://www.jneurosci.org/content/27/14/3743.full.pdf, http://www.jneurosci.org/content/26/9/2424, http://www.ncbi.nlm.nih.gov/pubmed/17255512). <br></p>
<p><strong>Student said on 2016-07-21</strong></p>
<p>(Final) <br><br>I would like to note that the reason for this comment is not to malign Dr.&nbsp;Poldrack or his research, but rather to attempt to clarify Dr.&nbsp;Poldrack’s opinion of how others should view his previous research when it fails to meet the rigorous standards that he persistently endorses. I am very much in agreement with Dr.&nbsp;Poldrack that rigorous methodology and transparency are important foundations for building a strong science. As a graduate student, it is frustrating to see high-profile scientists such as Dr.&nbsp;Poldrack call for increased methodological rigor by new researchers (typically while, rightfully, labeling work that does not meet methodological standards as being unreliable) when they (1) have benefited (and arguably continue to benefit) from the relatively lower barriers to entry that come from having entered a research field before the emergence of a rigid methodological framework (i.e.&nbsp;in having Neuron/PNAS/Science papers on their CV that would not be published in a low-tier journal today due to their methodological problems) , and (2) not applying the same level of criticism or skepticism to their own previous work as they do to emerging work when it does not meet current standards of rigor or transparency. I would like to know what Dr.&nbsp;Poldrack’s opinions are on these issues. I greatly appreciate any time and/or effort spent reading and/or replying to this comment. <br><br><br><br></p>
<p><strong>Russ Poldrack said on 2016-07-21</strong></p>
<p>thanks for your comments. I will address them in an upcoming blog post.</p>
<p><strong>Russ Poldrack said on 2016-07-22</strong></p>
<p>here is my response, thanks again for your comments: http://www.russpoldrack.org/2016/07/having-my-cake-and-eating-it-too.html</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>